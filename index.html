<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="lifePAD - Primary Artistry Device. A creative sketch pad and design tool with hand-drawn diagrams, shapes, text, and artistic brushes. Privacy-first PWA promoting creativity and artistic expression.">
    <meta name="theme-color" content="#2c2c2c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="lifePAD">
    <title>lifePAD</title>
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="icon" type="image/png" href="icons/lifepad.PNG">
    <link rel="apple-touch-icon" href="icons/lifepad.PNG">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Walkthrough Modal -->
    <div id="walkthrough-modal" class="walkthrough-modal">
        <div class="walkthrough-content">
            <button id="close-walkthrough" class="walkthrough-close" title="Close walkthrough">&times;</button>
            
            <!-- Slide 0: Welcome -->
            <div class="walkthrough-slide active" data-slide="0">
                <div class="walkthrough-header">
                    <img src="icons/lifepad.PNG" alt="lifePAD Logo" class="walkthrough-logo">
                    <h1>Welcome to lifePAD</h1>
                    <p class="walkthrough-subtitle">Primary Artistry Device</p>
                </div>
                <div class="walkthrough-body">
                    <h2>In Memory of Shirley Parrish</h2>
                    <p>This app is dedicated to the memory of Shirley Parrish, who taught the creator how to paint, draw, and embrace creativity. Her passion for art and design inspired this tool to help others express their creative vision.</p>
                    <p style="margin-top: 16px;">Let us show you how to use lifePAD to express your creativity.</p>
                </div>
            </div>
            
            <!-- Slide 1: Drawing Basics -->
            <div class="walkthrough-slide" data-slide="1">
                <div class="walkthrough-body">
                    <div class="walkthrough-image">
                        <img src="walkthrough/slide1.svg" alt="Drawing with touch, mouse, or stylus">
                    </div>
                    <h2>Start Drawing</h2>
                    <p>Draw freely on the canvas using your finger, mouse, or stylus. The app supports pressure-sensitive drawing on devices with stylus support.</p>
                    <p><strong>Best on tablets with stylus</strong> for the optimal creative experience.</p>
                </div>
            </div>
            
            <!-- Slide 2: Colors and Brushes -->
            <div class="walkthrough-slide" data-slide="2">
                <div class="walkthrough-body">
                    <div class="walkthrough-image">
                        <img src="walkthrough/slide2.svg" alt="Color selection and brush size">
                    </div>
                    <h2>Colors and Brushes</h2>
                    <p>Choose from 8 preset colors or use the custom color picker. Adjust the brush size from 1 to 48 pixels using the size slider.</p>
                    <p>Try different brush textures: Ink, Pencil, Marker, Spray, and Charcoal for varied artistic effects.</p>
                </div>
            </div>
            
            <!-- Slide 3: Shapes and Tools -->
            <div class="walkthrough-slide" data-slide="3">
                <div class="walkthrough-body">
                    <div class="walkthrough-image">
                        <img src="walkthrough/slide3.svg" alt="Shapes, arrows, and text">
                    </div>
                    <h2>Shapes and Text</h2>
                    <p>Click the Tools dropdown and select Shapes to access rectangles, circles, triangles, arrows, stars, diamonds, and ellipses.</p>
                    <p>Use the Text tool to add labels and annotations to your drawings. Toggle hand-drawn style for a sketchy look.</p>
                </div>
            </div>
            
            <!-- Slide 4: Editing Tools -->
            <div class="walkthrough-slide" data-slide="4">
                <div class="walkthrough-body">
                    <div class="walkthrough-image">
                        <img src="walkthrough/slide4.svg" alt="Undo, redo, clear, save, and zoom">
                    </div>
                    <h2>Editing and Controls</h2>
                    <p>Use Undo and Redo to manage your drawing history. Clear the canvas to start fresh, or Save PNG to export your work.</p>
                    <p>Zoom in and out using the zoom buttons or pinch gestures. Pan around the canvas with the Pan tool.</p>
                </div>
            </div>
            
            <!-- Slide 5: Themes and Offline -->
            <div class="walkthrough-slide" data-slide="5">
                <div class="walkthrough-body">
                    <div class="walkthrough-image">
                        <img src="walkthrough/slide5.svg" alt="Theme toggle and offline mode">
                    </div>
                    <h2>Themes and Privacy</h2>
                    <p>Toggle between light and dark themes using the Theme button. Enable Paper mode for a warm, off-white background.</p>
                    <p>lifePAD works completely offline after the first load. All your drawings stay on your device with no data sent anywhere.</p>
                </div>
            </div>
            
            <!-- Slide 6: Collaboration -->
            <div class="walkthrough-slide" data-slide="6">
                <div class="walkthrough-body">
                    <div class="walkthrough-image">
                        <img src="walkthrough/slide6.svg" alt="Real-time collaboration">
                    </div>
                    <h2>Collaborate Securely</h2>
                    <p>Click the Collab button to start a real-time collaboration session with another person.</p>
                    <p>All collaboration uses peer-to-peer connections with end-to-end encryption. No servers, no tracking, just secure creative collaboration.</p>
                </div>
            </div>
            
            <!-- Navigation -->
            <div class="walkthrough-navigation">
                <button id="walkthrough-prev" class="walkthrough-nav-btn">Previous</button>
                <div class="walkthrough-dots" id="walkthrough-dots">
                    <span class="walkthrough-dot active" data-slide="0"></span>
                    <span class="walkthrough-dot" data-slide="1"></span>
                    <span class="walkthrough-dot" data-slide="2"></span>
                    <span class="walkthrough-dot" data-slide="3"></span>
                    <span class="walkthrough-dot" data-slide="4"></span>
                    <span class="walkthrough-dot" data-slide="5"></span>
                    <span class="walkthrough-dot" data-slide="6"></span>
                </div>
                <button id="walkthrough-next" class="walkthrough-nav-btn primary">Next</button>
            </div>
            
            <div class="walkthrough-footer">
                <label class="checkbox-label">
                    <input type="checkbox" id="dont-show-walkthrough">
                    <span>Do not show again</span>
                </label>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app">
        <!-- Menu Toggle Button (Hamburger) -->
        <button id="menu-toggle" class="menu-toggle" title="Toggle menu" aria-label="Toggle menu">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
        
        <!-- Top Navbar -->
        <nav class="navbar">
            <div class="nav-section colors-section">
                <label>Colors:</label>
                <div class="color-swatches">
                    <button class="color-swatch active" data-color="#000000" style="background: #000000;" title="Black"></button>
                    <button class="color-swatch" data-color="#ff4444" style="background: #ff4444;" title="Red"></button>
                    <button class="color-swatch" data-color="#4488ff" style="background: #4488ff;" title="Blue"></button>
                    <button class="color-swatch" data-color="#44cc44" style="background: #44cc44;" title="Green"></button>
                    <button class="color-swatch" data-color="#ffcc44" style="background: #ffcc44;" title="Yellow"></button>
                    <button class="color-swatch" data-color="#ff8844" style="background: #ff8844;" title="Orange"></button>
                    <button class="color-swatch" data-color="#cc44cc" style="background: #cc44cc;" title="Purple"></button>
                    <button class="color-swatch" data-color="#ffffff" style="background: #ffffff; border: 1px solid #ccc;" title="White"></button>
                    <input type="color" id="custom-color" value="#000000" title="Custom color">
                </div>
            </div>

            <div class="nav-section">
                <label for="pen-size">Size:</label>
                <input type="range" id="pen-size" min="1" max="48" value="4" step="1">
                <span id="pen-size-value">4</span>
            </div>

            <div class="nav-section">
                <label for="hue-shift">Hue:</label>
                <input type="range" id="hue-shift" min="-180" max="180" value="0" step="1">
                <span id="hue-shift-value">0°</span>
            </div>

            <div class="nav-section">
                <label for="brush-texture">Texture:</label>
                <select id="brush-texture">
                    <option value="ink">Ink</option>
                    <option value="pencil">Pencil</option>
                    <option value="marker">Marker</option>
                    <option value="spray">Spray</option>
                    <option value="charcoal">Charcoal</option>
                </select>
            </div>

            <div class="nav-section actions-section">
                <button id="select-tool" class="tool-btn" title="Select and move objects">Select</button>
                <button id="text-tool" class="tool-btn" title="Add text">Text</button>
                <button id="pan-tool" class="tool-btn" title="Pan canvas">Pan</button>
                <button id="brush-eraser-toggle" class="tool-btn active" title="Toggle Brush/Eraser">Brush</button>
                <button id="undo-btn" class="tool-btn" title="Undo">Undo</button>
                <button id="redo-btn" class="tool-btn" title="Redo">Redo</button>
                <button id="clear-btn" class="tool-btn" title="Clear canvas">Clear</button>
                <button id="save-btn" class="tool-btn primary" title="Save as PNG">Save PNG</button>
                <div class="tools-dropdown">
                    <button id="tools-btn" class="tool-btn" title="Tools">Tools ▼</button>
                    <div id="tools-menu" class="dropdown-menu">
                        <button id="shapes-btn" class="dropdown-item">Shapes</button>
                        <button id="ruler-btn" class="dropdown-item">Ruler</button>
                        <button id="import-bg-btn" class="dropdown-item">Import Background</button>
                        <button id="export-svg-btn" class="dropdown-item">Export SVG</button>
                    </div>
                </div>
                <button id="help-btn" class="tool-btn" title="Help">Help</button>
                <button id="install-btn" class="tool-btn" title="Install app" style="display: none;">Install</button>
            </div>

            <div class="nav-section collab-status-section">
                <button id="collab-btn" class="tool-btn" title="Collaboration">Collab</button>
                <span id="collab-status" class="collab-status">Disconnected</span>
                <span id="tool-status" class="tool-status">Tool: Brush</span>
            </div>

            <div class="nav-section settings-section">
                <button id="theme-toggle" class="tool-btn" title="Toggle theme">Theme</button>
                <label class="checkbox-label small">
                    <input type="checkbox" id="paper-bg">
                    <span>Paper</span>
                </label>
            </div>
            
            <div class="nav-section zoom-section">
                <button id="zoom-out-btn" class="tool-btn" title="Zoom out">-</button>
                <span id="zoom-level">100%</span>
                <button id="zoom-in-btn" class="tool-btn" title="Zoom in">+</button>
                <button id="zoom-reset-btn" class="tool-btn" title="Reset zoom">Reset</button>
            </div>
        </nav>

        <!-- Canvas Container -->
        <div id="canvas-container">
            <canvas id="bgCanvas"></canvas>
            <canvas id="drawCanvas"></canvas>
            <canvas id="overlay-canvas"></canvas>
            <!-- Shapes Panel -->
            <div id="shapes-panel" class="shapes-panel hidden">
                <div class="panel-header">
                    <h3>Shapes</h3>
                    <button id="close-shapes" class="close-btn">✕</button>
                </div>
                <div class="shapes-grid">
                    <button class="shape-btn" data-shape="rectangle" title="Rectangle">▭</button>
                    <button class="shape-btn" data-shape="circle" title="Circle">○</button>
                    <button class="shape-btn" data-shape="line" title="Line">/</button>
                    <button class="shape-btn" data-shape="triangle" title="Triangle">△</button>
                    <button class="shape-btn" data-shape="arrow" title="Arrow">→</button>
                    <button class="shape-btn" data-shape="star" title="Star">★</button>
                    <button class="shape-btn" data-shape="diamond" title="Diamond">◇</button>
                    <button class="shape-btn" data-shape="ellipse" title="Ellipse">⬭</button>
                </div>
                <div class="shape-controls">
                    <label>
                        <input type="checkbox" id="shape-fill" />
                        <span>Fill shape</span>
                    </label>
                    <label>
                        <input type="checkbox" id="shape-rough" />
                        <span>Hand-drawn style</span>
                    </label>
                </div>
            </div>
            <!-- Ruler Overlay -->
            <div id="ruler-overlay" class="ruler-overlay hidden">
                <div class="ruler-container">
                    <div class="ruler horizontal-ruler" id="horizontal-ruler">
                        <div class="ruler-measurements"></div>
                    </div>
                    <div class="ruler vertical-ruler" id="vertical-ruler">
                        <div class="ruler-measurements"></div>
                    </div>
                </div>
                <div class="ruler-controls">
                    <div class="ruler-control-group">
                        <label for="ruler-scale">Scale (pixels per meter):</label>
                        <input type="range" id="ruler-scale" min="50" max="200" value="100" step="10">
                        <span id="ruler-scale-value">100</span>
                    </div>
                    <button id="ruler-reset" class="secondary-btn">Reset Position</button>
                </div>
                <button id="close-ruler" class="close-ruler-btn">Close Ruler</button>
            </div>
        </div>
    </div>

    <!-- Text Input Dialog -->
    <div id="text-dialog" class="text-dialog hidden">
        <div class="text-dialog-content">
            <textarea id="text-input" placeholder="Enter text..." rows="4"></textarea>
            <div class="text-dialog-actions">
                <button id="text-confirm" class="primary-btn">Add Text</button>
                <button id="text-cancel" class="secondary-btn">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Hidden file input for background image import -->
    <input type="file" id="bg-image-input" accept="image/*" style="display: none;">

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Collaboration Modal -->
    <div id="collab-modal" class="modal-overlay hidden">
        <div class="modal-content collab-modal">
            <div class="modal-header">
                <h2>Collaboration</h2>
                <button id="close-collab-modal" class="close-btn" title="Close">&times;</button>
            </div>
            
            <div class="modal-tabs">
                <button class="tab-btn active" data-tab="host">Host Session</button>
                <button class="tab-btn" data-tab="join">Join Session</button>
            </div>
            
            <div class="modal-body">
                <!-- Host Tab -->
                <div id="host-tab" class="tab-content active">
                    <div class="info-box">
                        <p><strong>How to host:</strong></p>
                        <ol>
                            <li>Enter a session passphrase (share this with your partner)</li>
                            <li>Click "Create offer" - it will auto-copy to clipboard</li>
                            <li>Send the copied text to your partner (via chat, email, etc.)</li>
                            <li>When your partner sends back their response, paste it below</li>
                            <li>Click "Connect" to establish connection</li>
                        </ol>
                    </div>
                    
                    <div class="form-group">
                        <label for="host-passphrase">Session Passphrase:</label>
                        <input type="password" id="host-passphrase" placeholder="Enter a strong passphrase" autocomplete="off">
                    </div>
                    
                    <button id="create-offer-btn" class="primary-btn">Create Offer</button>
                    
                    <div id="offer-output" class="output-section hidden">
                        <label>Connection Data (auto-copied to clipboard):</label>
                        <textarea id="offer-blob" readonly rows="6"></textarea>
                        <button id="copy-offer-btn" class="secondary-btn">Copy Again</button>
                    </div>
                    
                    <div id="answer-input" class="input-section hidden">
                        <div class="form-group">
                            <label for="answer-blob-input">Response from Partner:</label>
                            <textarea id="answer-blob-input" placeholder="Paste response text here" rows="6"></textarea>
                        </div>
                        <button id="apply-answer-btn" class="primary-btn">Connect</button>
                    </div>
                </div>
                
                <!-- Join Tab -->
                <div id="join-tab" class="tab-content">
                    <div class="info-box">
                        <p><strong>How to join:</strong></p>
                        <ol>
                            <li>Get the passphrase from the host</li>
                            <li>Enter the passphrase below</li>
                            <li>Paste the connection text from the host</li>
                            <li>Click "Create answer" - it will auto-copy to clipboard</li>
                            <li>Send the copied text back to the host</li>
                            <li>Wait for host to complete connection - session will begin</li>
                        </ol>
                    </div>
                    
                    <div class="form-group">
                        <label for="join-passphrase">Session Passphrase:</label>
                        <input type="password" id="join-passphrase" placeholder="Same passphrase as host" autocomplete="off">
                    </div>
                    
                    <div class="form-group">
                        <label for="offer-blob-input">Connection Data from Host:</label>
                        <textarea id="offer-blob-input" placeholder="Paste connection data here" rows="6"></textarea>
                    </div>
                    
                    <button id="create-answer-btn" class="primary-btn">Create Answer</button>
                    
                    <div id="answer-output" class="output-section hidden">
                        <label>Response Data (auto-copied to clipboard):</label>
                        <textarea id="answer-blob" readonly rows="6"></textarea>
                        <button id="copy-answer-btn" class="secondary-btn">Copy Again</button>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="disconnect-btn" class="secondary-btn hidden">Disconnect</button>
                <div id="collab-error" class="error-message hidden"></div>
            </div>
        </div>
    </div>

    <!-- iOS Install Help Modal -->
    <div id="ios-install-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Install on iOS</h2>
                <button id="close-ios-install" class="close-btn" title="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="info-box">
                    <p><strong>To install lifePAD on your iOS device:</strong></p>
                    <ol>
                        <li>Tap the Share button at the bottom of Safari (square with arrow pointing up)</li>
                        <li>Scroll down and tap "Add to Home Screen"</li>
                        <li>Tap "Add" in the top right corner</li>
                        <li>lifePAD will appear on your home screen like a native app</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Connection Success Modal -->
    <div id="connection-success-modal" class="modal-overlay hidden">
        <div class="modal-content connection-success">
            <div class="modal-header">
                <h2>Successfully Connected!</h2>
            </div>
            <div class="modal-body">
                <div class="connection-names">
                    <div class="name-item">
                        <span class="name-label">You are:</span>
                        <span id="local-name-display" class="name-value"></span>
                    </div>
                    <div class="connection-arrow">↔</div>
                    <div class="name-item">
                        <span class="name-label">Connected to:</span>
                        <span id="remote-name-display" class="name-value"></span>
                    </div>
                </div>
                <p class="connection-message">You can now see each other's cursors and collaborate in real-time!</p>
            </div>
            <div class="modal-footer">
                <button id="close-connection-success" class="primary-btn">Start Collaborating</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
